#textdomain wesnoth-Town_of_Arnsreach

[scenario]
    
	
	#define Scenario_Setup
		
		##########	Scenario setup	##########
		victory_when_enemies_defeated=no
		description="With snow ahead."
		id="Arnsreach_Scenario_01"
		map_file="Arnsreach_Scenario_1.map"
		name=_"The Bitter Cold"
		random_start_time=no
		turns=-1
		{DEFAULT_MUSIC_PLAYLIST}
		
		
		[side] ##########	Setup player side	##########
			controller="human"
			fog=yes
		#	fog=no
			shroud=yes
		#	shroud=no
			gold=0
			hidden=no
			income=0
			no_leader=yes
			share_vision="none"
			side=1
			team_name=Player_alliance
			side_name=_"Scouts"
			[unit]
				{CHARACTER_STATS_GAR}
				facing="sw"
				x,y=78,92
			[/unit]
			{CHARACTER_UPGRADE_GAR}
			[unit]
				{CHARACTER_STATS_MUDOC}
				facing="sw"
				x,y=77,92
			[/unit]
			{CHARACTER_UPGRADE_MUDOC}
			[unit]
				{CHARACTER_STATS_MERISSA}
				facing="nw"
				x,y=77,93
			[/unit]
			{CHARACTER_UPGRADE_MERISSA}
			[unit]
				{CHARACTER_STATS_ARNELDA}
				facing="s"
				x,y=76,92
			[/unit]
		[/side]
		
		[side] ##########	Setup Townspeople side	##########
			controller="null"
			fog=yes
			gold=0
			hidden=no
			income=0
			no_leader=yes
			share_vision="all"
			shroud=yes
			side=2
			side_name="Townspeople"
			team_name=Player_alliance
			[ai]
				ai_algorithm=idle_ai
			[/ai]
		[/side]
		
		[side] ##########	Setup Wild aggressive things side	##########
			controller="ai"
			fog=yes
			gold=0
			hidden=no
			income=0
			no_leader=yes
			share_vision="all"
			shroud=yes
			side=3
			team_name=Wilderness_alliance
			side_name=_"Wild agressive things"
		[/side]
		
		[side] ##########	Setup Orcs side	##########
			controller="ai"
			fog=yes
			gold=0
			hidden=no
			income=0
			no_leader=yes
			share_vision="all"
			shroud=yes
			side=4
			team_name=Orc_alliance
			side_name=_"Orcs"
		[/side]
			
		[side] ##########	Northen Refugees side	##########
			controller="ai"
			fog=yes
			gold=0
			hidden=no
			income=0
			no_leader=yes
			share_vision="all"
			shroud=yes
			side=5
			team_name=Player_alliance
			side_name=_"Northeners"
			[ai]
				ai_algorithm=idle_ai
			[/ai]
		[/side]
		
		[side] ##########	Undead	##########
			controller="ai"
			fog=yes
			gold=0
			hidden=no
			income=0
			no_leader=yes
			share_vision="all"
			shroud=yes
			side=6
			team_name=Undead_alliance
			side_name=_"Undead"
		[/side]
		
		[side] ##########	Setup Wild things side	##########
			controller="ai"
			fog=no
			gold=0
			hidden=no
			income=0
			no_leader=yes
			share_vision="none"
			shroud=no
			side=7
			team_name=Wilderness_alliance, Undead_alliance, Player_alliance, Orc_alliance
			side_name=_"Wild things"
		[/side]
		
		[side] ##########	Walking Corpse	##########
			controller="ai"
			fog=yes
			gold=0
			hidden=no
			income=0
			no_leader=yes
			share_vision="none"
			shroud=yes
			side=8
			team_name=Player_alliance
			side_name=_"Walking Corpse"
			[ai]
				[goal]
					name=target
					[criteria]
						id="gar"
					[/criteria]
					value=1
				[/goal]
			[/ai]
		[/side]
		
		[event] ##########	Pre start	##########
			name=prestart
			id=prestart
			
			##########	Variables	##########
			[set_variable]
				name=ToA.Town.Valuables
				value=0
			[/set_variable]
			[set_variable]
				name=ToA.Town.Prosperity
				value=0
			[/set_variable]
			[set_variable]
				name=ToA.Town.Population
				value=0
			[/set_variable]
			[set_variable]
				name=ToA.Scenario_Specific.Secrets_Counter
				value=0
			[/set_variable]
			[set_variable]
				name=ToA.Scenario_Specific.Secrets_Counter_Max
				value=6
			[/set_variable]
			[set_variable]
				name=ToA.Scenario_Specific.Secrets_Ghost_Count
				value=0
			[/set_variable]
			[set_variable]
				name=ToA.Characters.Gar.Sword
				value=false
			[/set_variable]
			
			##########	Scene setting	##########	
			[music]
				name=journeys_end.ogg
				play_once=yes
			[/music]
			[lua]
				code=<<	
					wesnoth.dofile '~add-ons/Town_of_Arnsreach/utils/ui.lua'								
				>>
			[/lua]
			[item]
				x,y=90, 84
				image="data/core/images/terrain/village/igloo.png"
			[/item]
			[item]
				x,y=76, 91
				image="data/core/images/units/transport/boat.png~ROTATE(-20)"
			[/item]
			{PLACE_IMAGE data/core/images/items/ring-red.png 78 89}
			{PLACE_IMAGE data/core/images/terrain/misc/detritus/detritusB-14.png 78 89}
			{PLACE_IMAGE data/core/images/scenery/wreck.png 80 108}
			{PLACE_IMAGE data/core/images/items/leather-pack.png 92 80}
			{PLACE_IMAGE data/core/images/terrain/misc/detritus/detritusC-2.png 92 80}
			{PLACE_IMAGE data/core/images/items/buckler.png 121 97}
			{PLACE_IMAGE data/core/images/items/burial.png 121 97}
			
			##Wildlife
			{NAMED_GENERIC_UNIT 7 (Frost Stoat) 76 98 wild_animal_1 (Frost Stoat)}
			[micro_ai]
				side=7
				ai_type=coward
				action=add
				[filter]
					id=wild_animal_1
				[/filter]
				attack_if_trapped=yes
				[filter_second]
					side=1,2,3,4,5,6
				[/filter_second]
				distance=6
				seek_x,seek_y=76,98
			[/micro_ai]
			{NAMED_GENERIC_UNIT 7 (Frost Stoat) 81 111 wild_animal_2 (Frost Stoat)}
			[micro_ai]
				side=7
				ai_type=coward
				action=add
				[filter]
					id=wild_animal_2
				[/filter]
				attack_if_trapped=yes
				[filter_second]
					side=1,2,3,4,5,6
				[/filter_second]
				distance=6
				seek_x,seek_y=81,111
			[/micro_ai]
			{NAMED_GENERIC_UNIT 7 (Frost Stoat) 113 107 wild_animal_3 (Frost Stoat)}
			[micro_ai]
				side=7
				ai_type=coward
				action=add
				[filter]
					id=wild_animal_3
				[/filter]
				attack_if_trapped=yes
				[filter_second]
					side=1,2,3,4,5,6
				[/filter_second]
				distance=6
				seek_x,seek_y=113,107
			[/micro_ai]
			{NAMED_GENERIC_UNIT 7 (Woodland Boar) 92 98 wild_animal_4 (Woodland Boar)}
			{NAMED_GENERIC_UNIT 7 (Piglet) 93 99 wild_animal_5 (Piglet)}
			{NAMED_GENERIC_UNIT 7 (Piglet) 93 98 wild_animal_6 (Piglet)}
			[micro_ai]
				side=7
				ai_type=coward
				action=add
				[filter]
					id=wild_animal_4,wild_animal_5,wild_animal_6
				[/filter]
				attack_if_trapped=yes
				[filter_second]
					side=1,2,3,4,5,6
				[/filter_second]
				distance=6
				seek_x,seek_y=92,98
			[/micro_ai]
			{NAMED_GENERIC_UNIT 7 (Rabbit) 85 92 wild_animal_7 (Rabbit)}
			[micro_ai]
				side=7
				ai_type=coward
				action=add
				[filter]
					id=wild_animal_7
				[/filter]
				attack_if_trapped=yes
				[filter_second]
					side=1,2,3,4,5,6
				[/filter_second]
				distance=6
				seek_x,seek_y=85,92
			[/micro_ai]
			{NAMED_GENERIC_UNIT 7 (Rabbit) 91 91 wild_animal_8 (Rabbit)}
			[micro_ai]
				side=7
				ai_type=coward
				action=add
				[filter]
					id=wild_animal_8
				[/filter]
				attack_if_trapped=yes
				[filter_second]
					side=1,2,3,4,5,6
				[/filter_second]
				distance=6
				seek_x,seek_y=91,91
			[/micro_ai]
			{NAMED_GENERIC_UNIT 7 (Rabbit) 109 93 wild_animal_9 (Rabbit)}
			[micro_ai]
				side=7
				ai_type=coward
				action=add
				[filter]
					id=wild_animal_9
				[/filter]
				attack_if_trapped=yes
				[filter_second]
					side=1,2,3,4,5,6
				[/filter_second]
				distance=6
				seek_x,seek_y=109,93
			[/micro_ai]
	
			##########	Clean up	##########
			[remove_event]
				id=prestart
			[/remove_event]
		[/event]

		[event] ##########	Start, pick your starting point here	##########
			name=start
			id=start
			
			##########	Starting main objective event trigger	##########
			[set_variable]
				name=ToA.Campaign_General.Debug_On
				value=false
			[/set_variable]
			[fire_event]
				name=main_1_Reach_Mountain_start		
				
				## change to debug main_1_Reach_Mountain_start -- main_2_Make_Camp_start -- main_3_Scout_North_start -- main_4_Prepare_Arrival_start -- main_5_Bitter_Taste_start
			[/fire_event]
			
			##########	Clean up	##########
			[remove_event]
				id=start
			[/remove_event]
		[/event]
	#enddef
	
	[event] ##########	Main objective 1: Reach the mountain, start	##########
		id=main_1_Reach_Mountain_start
		name=main_1_Reach_Mountain_start
		
		##########	Scene setting	##########
		[replace_schedule]
			{MORNING}	
		[/replace_schedule]
		[scroll_to] #set the starting camera location
			x,y=77,93
			immediate=yes
		[/scroll_to]
		
		[sound_source]
			id=windy
			sounds="data/add-ons/Animated_Weather_and_Scenery/sounds/wind.wav"
			loop=-1
			full_range=30
			fade_range=10
			check_fogged=false
			check_shrouded=false
			x,y=100,100
		[/sound_source]
		[AWaS_Create_Basic_Scenery]
			id=windy1
			Scenery_Type=wind_ne_fast
			[filter_location]
				x=100
				y=100
				radius=40
			[/filter_location]
		[/AWaS_Create_Basic_Scenery]
		[AWaS_Create_Basic_Scenery]
			id=windy2
			Scenery_Type=wind_ne_slow
			[filter_location]
				x=100
				y=100
				radius=40
			[/filter_location]
		[/AWaS_Create_Basic_Scenery]
		[AWaS_Create_HoveringObject_Scenery]
			id=bird
			Scenery_Type=falcon_hovering
			[filter_location]
				x=96
				y=96
				radius=25
			[/filter_location]
		[/AWaS_Create_HoveringObject_Scenery]
	
		##########	Scene animation	##########
		[lua] 
			code=<< wesnoth.interface.add_overlay_text(_"The ship sails away, back from where you came.", {location={0,0}, duration=5000, valign="center", halign="center", size=30, color={150,150,150}, fade_time=2000}) >> 
		[/lua]
		[unit]
			id=Ship
			side=2
			name=_"Ship"
			type="Galleon"
			canrecruit=no
			facing="e"
			x,y=73,94
		[/unit]
		[redraw]
			clear_shroud=yes
		[/redraw]
		[lua] 
			code=<< wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/rumor-sound-sea-foam_92bpm.wav") >> 
		[/lua]
		{MOVE_UNIT (id=Ship) 55 99} #leaving ship
		[kill] #removes the ship
			id=Ship
		[/kill]
		{SPEAK gar (_ "So, where do we start?")}
		{SPEAK arnelda (_ "I spotted a mountain peak to the southeast, should make for a good vantage point over these lands.")}
		{SPEAK arnelda (_ "If we follow the coastline we should reach it before nightfall.")}
		[lua] 
			code=<< wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/wind-gust_A_minor.wav") >> 
		[/lua]
		[label]
			x,y=75,93
			text= "			Islet of Gaze"
		[/label]

		##########	Handle objectives	##########
		[objectives]
			{OBJECTIVE (_"Follow the coastline to reach the mountain") (win)}
			{DEFEAT_OBJECTIVE}
			{SECRETS_NOTE}
			[note]
				description=_"All experience mechanics are disabeled"
			[/note]
			[note]
				description=_"The death of non-loyal units has no impact"
			[/note]
		[/objectives]
		[set_variable] #Main objective counter
            name=ToA.Scenario_Specific.Main_Objective_Counter
            value=1
        [/set_variable]
		[set_variable] #Sub objective counter
            name=ToA.Scenario_Specific.Sub_Objective_Counter
            value=1
        [/set_variable]
		[remove_shroud] # removes the shroud on the new goal
			side=1
			x,y=107,107
			radius=1
		[/remove_shroud]
		{HIGHLIGHT_IMAGE 107 107 "items/gohere.png" ()}
		{SCROLL_TO 77 93}
		
		##########	Clean up	##########
		[remove_event]
			id=main_1_Reach_Mountain_start
		[/remove_event]
	[/event]
	
	[event] ##########	Sub objective 1 (main 1): Angry Ent	##########
		id=main_1_sub_1_Angry_Ent
		
		##########	Trigger conditions	##########
		name=enter hex
		[filter]
			side=1
			[filter_location]
				x,y=84,100
				radius=5
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=1
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=1
				[/variable]
			[/and]
		[/filter_condition]
			
		##########	Scene setting/animation	##########
		[unit]
			id=main_1_Angry_Ent
			side=3
			name=_"Nettled Wose"
			type="Wose"
			ai_special=guardian
			canrecruit=no
			facing="w"
			x,y=84,100
			hitpoints=38
			max_moves=10
		[/unit]
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=2
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_1_sub_1_Angry_Ent
		[/remove_event]

	[/event]
	
	[event] ##########	Sub objective 2 (main 1): Angry Ent attack	##########
		id=main_1_sub_2_Angry_Ent_attacks
		
		##########	Trigger conditions	##########
		name=attack
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=1
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=2
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		{SPEAK arnelda (_ "Get behind me!")}
		{PLAYER_MOVEMENT_RESET}
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=3
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_1_sub_2_Angry_Ent_attacks
		[/remove_event]	
	[/event]
		
	[event] ##########	Sub objective 3 (main 1): Angry Ent dead	##########
		id=main_1_sub_3_Angry_Ent_dead
		
		##########	Trigger conditions	##########
		name=die
		[filter]
            id=main_1_Angry_Ent
        [/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=1
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=3
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting/animation	##########
		{SPEAK merissa (_ "It seems these lands are hostile to newcomers.")}
		{SPEAK gar (_ "Or something else angered it first.")}
		{SPEAK arnelda (_ "Keep your eyes on the tree line.")}	
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=4
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_1_sub_3_Angry_Ent_dead
		[/remove_event]
	[/event]
	
	[event] ##########	Sub objective 4 (main 1): Goblin spotted	##########
		id=main_1_sub_4_Goblin_spotted
		
		##########	Trigger conditions	##########
		name=enter hex
		[filter]
			side=1
			[filter_location]
				x,y=92,105
				radius=7
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=1
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=4
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting/animation	##########
		{SCROLL_TO 87 105}
		{MOVE_UNIT (id=arnelda) 87 105}
		{MOVE_UNIT (id=mudoc) 87 104}
		{MOVE_UNIT (id=gar) 86 103}
		{MOVE_UNIT (id=merissa) 86 104}
		{SCROLL_TO 87 105}
		[lua] 
			code=<< wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/wind-gust_A_minor.wav") >> 
		[/lua]
		{SPEAK mudoc (_ "What was that..")}
		[unit]
			id=main_1_Goblin_Scout
			side=4
			name=_"Gak Gak"
			type="Wolf Rider"
			canrecruit=no
			facing="sw"
			x,y=91,104
		[/unit]
		[remove_shroud]
			side=1
			x,y=89,105
			radius=4
		[/remove_shroud]
		[lift_fog]
			[filter_location]
				[filter]
					side=1
				[/filter]
				x,y=89,105
				radius=4
			[/filter_location]
		[/lift_fog]
		[delay]
			time=1000
		[/delay]
		{SPEAK arnelda (_ "Orc scout! get it!")}
		{MOVE_UNIT (id=main_1_Goblin_Scout) 105 102}
		[kill]
			id=main_1_Goblin_Scout
		[/kill]
		[lua] 
			code=<< ToA_New_Scene_Start({Fast=false}) wesnoth.interface.delay(500) >> 
		[/lua]
		[reset_fog]
			[filter]
				side=1
			[/filter]
			reset_view=yes
		[/reset_fog]
		[redraw]
			clear_shroud=yes
		[/redraw]
		{TELEPORT_UNIT (id=arnelda) 95 104}
		{TELEPORT_UNIT (id=gar)  93 101}
		{TELEPORT_UNIT (id=mudoc) 96 102}
		{TELEPORT_UNIT (id=merissa) 91 106}
		[lua] 
			code=<< ToA_New_Scene_Finish({Text="Half an hour later", Text_Size=80, Map_Location_X=92, Map_Location_Y=104, Fast=true}) >> 
		[/lua]
		{MOVE_UNIT (id=arnelda) 92 105}
		{MOVE_UNIT (id=gar) 91 105}
		{MOVE_UNIT (id=mudoc) 93 106}
		{SPEAK gar (_ "I didn't find anything.")}
		{SPEAK mudoc (_ "Tracks lead east.")}
		{SPEAK arnelda (_ "The orcs now know we are here, expect trouble.")}
		{SPEAK merissa (_ "That was a goblin, by the way.")}
		{PLAYER_MOVEMENT_RESET}
		{PLAYER_MOVEMENT_POINTS_MAX}

		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=5
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_1_sub_4_Goblin_spotted
		[/remove_event]
	[/event]
	
	[event] ##########	Sub objective 5 (main 1): Secret sword part 1	##########
		id=main_1_sub_5_Secret_Sword_1
		
		##########	Trigger conditions	##########
		name=enter hex
		[filter]
			side=1
			[filter_location]
				x,y=100,106
				radius=3
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=1
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=5
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting/animating	##########
		{SPEAK gar (_ "I saw some kind of structure on the ice, south of us.")}
		{SPEAK gar (_ "How about a detour?")}
		{PLAYER_MOVEMENT_RESET}
	
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=6
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_1_sub_5_Secret_Sword_1
		[/remove_event]
	[/event]
	
	[event] ##########	Sub objective 6 (main 1): Secret Sword part 2	##########
		id=main_1_sub_6_Secret_Sword_2
		
		##########	Trigger conditions	##########
		name=enter hex
		[filter]
			side=1
			[filter_location]
				x,y=93,112
				radius=2
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=1
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=6
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting/animating	##########
		{PLAYER_MOVE_TO 93 111}
		{SPEAK gar (_ "What is this supposed to be? ")}
		{SPEAK merissa (_ "There is faint magic about it.")}
		{SPEAK mudoc (_ "Great. A monument of magical time wasting. Lets go back.")}
		{MOVE_UNIT (id=mudoc) 95 110}
		{PLAYER_MOVEMENT_RESET}
		[lua] 
			code=<<	
				wesnoth.interface.add_hex_overlay(94, 108, {halo = "data/add-ons/Town_of_Arnsreach_Resources_1/images/spells/Force_Wave_Custom_Animation/[1~9].png:100, data/add-ons/Town_of_Arnsreach_Resources_1/images/spells/Force_Wave_Custom_Animation/[9].png:1000"})
				AWaS_Color_Change_And_Tremble_Over_Time(680, {{0.1,2,50,50,50}, {0.2,10,200,200,200}, {0.4,2,50,50,50}})
				wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/490253__anomaex__sci-fi_explosion_cut.wav")
			>>
		[/lua]
		[label]
			x,y=93,110
			text= _ "
Mire Foothold"
		[/label]
		[terrain]
			x,y=94,108
			terrain=Wwf^Edb
		[/terrain]
		{NAMED_GENERIC_UNIT 3 (Ghost) 94 108 SwordGhost (Wraith)}
		[modify_unit]
			[filter]
				id=SwordGhost
			[/filter]
			max_hitpoints=56
			hitpoints=48
		[/modify_unit]
		[lua] 
			code=<<	
				AWaS_Color_Change_And_Tremble_Over_Time(200, {{0,2,50,50,50}})
				wesnoth.interface.remove_hex_overlay(94, 108, "data/add-ons/Town_of_Arnsreach_Resources_1/images/spells/Force_Wave_Custom_Animation/[1~9].png:100, data/add-ons/Town_of_Arnsreach_Resources_1/images/spells/Force_Wave_Custom_Animation/[9].png:1000")
			>>
		[/lua]
		{SPEAK SwordGhost (_ "...can you take...")}
		{SPEAK SwordGhost (_ "...the promise?")}
	
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=7
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_1_sub_6_Secret_Sword_2
		[/remove_event]
	[/event]
	
	[event] ##########	Sub objective 7 (main 1): Secret Sword part 3	##########
		id=main_1_sub_7_Secret_Sword_3
		
		##########	Trigger conditions	##########
		name=die
		[filter]
            id=SwordGhost
        [/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=1
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=7
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting/animating	##########
		{SPEAK arnelda (_ "What was that?")}
		{SPEAK merissa (_ "A wraith. Bound here by a magical oath, I would guess.")}
		{SPEAK mudoc (_ "Remind me never to swear any oaths.")}
		{SPEAK merissa (_ "Don't worry, oath takers need some modicum of dedication for the magic to take hold.")}
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=8
		[/set_variable]
		[set_variable]
			name=ToA.Scenario_Specific.Secrets_Counter
			add=1
		[/set_variable]
		[set_variable]
			name=ToA.Scenario_Specific.Secrets_Ghost_Count
			value=1
		[/set_variable]
		[lua] 
			code=<< wesnoth.interface.add_overlay_text(_"A secret found", {location={0,0}, duration=3000, valign="center", halign="center", size=30, color={150,150,150}, fade_time=1000}) >> 
		[/lua]		
		
		##########	Clean up	##########
		[remove_event]
			id=main_1_sub_7_Secret_Sword_3
		[/remove_event]
	[/event]
			
	[event] ##########	Main objective 1: Reach the mountain, end	##########
		id=main_1_Reach_Mountain_end
		
		##########	Trigger conditions	##########
		name=enter hex
		[filter]
			side=1
			[filter_location] #if a unit enters the mountain, this unit triggers the next objective event
				x,y=107,107
				radius=3
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=1
			[/variable]
		[/filter_condition]
				
		##########	Scene setting/animation	##########
		[remove_item] # remove the go here sign from the map
			x,y=107,107
			image=items/gohere.png
		[/remove_item]
		{PLAYER_MOVEMENT_RESET}
		{PLAYER_MOVE_TO 107 107}
		{PLAYER_MOVEMENT_POINTS_0}
		{SCROLL_TO 107 107}

		##########	Handle objectives	##########
		[fire_event] #next objective event will be triggerd here
			name=main_2_Make_Camp_start
		[/fire_event]
		
		##########	Clean up	##########
		[remove_event]
			id=main_1_Reach_Mountain_end, main_1_sub_1_Angry_Ent, main_1_sub_2_Angry_Ent_attacks, main_1_sub_3_Angry_Ent_dead, main_1_sub_4_Goblin_spotted,  main_1_sub_5_Secret_Sword_1, main_1_sub_6_Secret_Sword_2, main_1_sub_7_Secret_Sword_3
		[/remove_event]
		[remove_sound_source]
			id=windy
		[/remove_sound_source]
		[AWaS_Delete_Basic_Scenery]
			id=windy1
		[/AWaS_Delete_Basic_Scenery]
		[AWaS_Delete_Basic_Scenery]
			id=windy2
		[/AWaS_Delete_Basic_Scenery]
	[/event]
	
	[event] ##########	Main objective 2: Camp in the clearing, start	##########
		id=main_2_Make_Camp_start
		
		name=main_2_Make_Camp_start
	
		##########	Scene setting: animating	##########
		[if]
			[variable]
				name=ToA.Campaign_General.Debug_On
				boolean_equals=true
			[/variable]
			[then]
				{TELEPORT_UNIT (id=arnelda) 107 107}
				{TELEPORT_UNIT (id=gar) 107 107}
				{TELEPORT_UNIT (id=mudoc) 107 107}
				{TELEPORT_UNIT (id=merissa) 107 107}
			[/then]
		[/if]
		[scroll_to] #set the camera location
			x,y=107,107
			immediate=yes
		[/scroll_to]
		[remove_shroud]
			side=1
			x,y=107,107
			radius=13
		[/remove_shroud]
		[lift_fog]
			[filter_location]
				[filter]
					side=1
				[/filter]
				x,y=107,107
				radius=13
			[/filter_location]
		[/lift_fog]
		[delay]
			time=1000
		[/delay]
		[lua] 
			code=<< 
				wesnoth.interface.select_unit()
				wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/drums.wav")
				wesnoth.interface.delay(500)	
				wesnoth.interface.add_overlay_text(_"The Bitter Cold", {location={0,0}, duration=3000, valign="center", halign="center", size=80, color={150,150,150}, fade_time=3000})
				wesnoth.interface.delay(2000)
			>> 
		[/lua]
		{SPEAK merissa (_ "Breathtaking.")}
		{SPEAK arnelda (_ "Promising...")}
		{SPEAK gar (_ "(<i>Glances at Arnelda.</i>) What is?")}	
		{SPEAK arnelda (_ "The forest clearing north of us. It's a good place for a camp.")}
		{PLAYER_MOVEMENT_RESET}
		[reset_fog]
			[filter]
				side=1
			[/filter]
			reset_view=yes
		[/reset_fog]
		[redraw]
			clear_shroud=yes
		[/redraw]
		[replace_schedule]
			{AFTERNOON}	
		[/replace_schedule]
		[label]
			x,y=122,104
			text= _ "
Spiked Cross"
		[/label]
		
		##########	Handle objectives: 	##########
		{HIGHLIGHT_IMAGE 106 97 "items/gohere.png" ()}
		[objectives]
			{OBJECTIVE ( _ "Make camp in the clearing.") (win)}
			{DEFEAT_OBJECTIVE}
			{SECRETS_NOTE}
			[note]
				description=_"All experience mechanics are disabeled"
			[/note]
			[note]
				description=_"The death of non-loyal units have no impact"
			[/note]
		[/objectives]
		[set_variable]
			name=ToA.Scenario_Specific.Main_Objective_Counter
			value=2
		[/set_variable]
		[set_variable]
            name=ToA.Scenario_Specific.Sub_Objective_Counter
            value=1
        [/set_variable]
		
		##########	Clean up	##########
		[remove_event]
			id=main_2_Make_Camp_start
		[/remove_event]
	[/event]
	
	[event] ##########	Sub objective 1 (main 2): banter 1	##########
		id=main_2_sub_1_Banter
		
		##########	Trigger conditions	##########
		name=enter hex
		[filter]
			side=1
			[filter_location]
				x,y=106,99
				radius=3
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=2
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=1
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		{SPEAK mudoc (_ "You know, magic is pretty nifty when the mage isn't a power-crazed maniac.")}
		{SPEAK merissa (_ "I am sure brutes have their uses too; I just haven't thought of any yet.")}
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=2
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_2_sub_1_Banter
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 2 (main 2): reached camp	##########
		id=main_2_sub_2_reached_camp
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=106,97
				radius=2
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=2
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=2
				[/variable]
			[/and]
		[/filter_condition]
		

		##########	Scene setting: animate scene	##########
		[remove_item] # remove the go here sign from the map
			x,y=106,97
			image=items/gohere.png
		[/remove_item]
		[replace_schedule]
			{DUSK}
		[/replace_schedule]
		{MOVE_UNIT (id=arnelda) 106 98}
		{MOVE_UNIT (id=gar) 105 99}
		{MOVE_UNIT (id=mudoc) 107 99}
		{MOVE_UNIT (id=merissa) 106 99}
		{SPEAK arnelda (_ "I will make the fire.")}
		{MOVE_UNIT (id=arnelda) 105 97}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/campfire_unlit.png 106 97}
		{MOVE_UNIT (id=merissa) 107 98}
		{PLACE_IMAGE data/core/images/terrain/village/camp3.png 107 98}
		{MOVE_UNIT (id=mudoc) 106 96}
		{PLACE_IMAGE data/core/images/terrain/village/camp2.png 106 96}
		{MOVE_UNIT (id=gar) 105 98}
		{MOVE_UNIT (id=mudoc) 107 97}
		{PLAYER_FACE_HEX 106}
		[terrain]
			x,y=106,97
			terrain=Aa^Ecf
		[/terrain]
		[remove_item] #remove the go here sign from the map
			x,y=106,97
			image=data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/campfire_unlit.png
		[/remove_item]
		{SPEAK mudoc (_ "(<i>Looks upwards.</i>)There is a snowstorm comming. Anyone else want to take the first guard shift?")}
		{SPEAK mudoc (_ "...No one?")}
		[sound_source]
			id=campfire_1
			sounds="data/add-ons/Town_of_Arnsreach_Resources_1/sounds/campfire.wav"
			loop=-1
			full_range=3
			fade_range=5
			chance=100
			delay=0
			check_fogged=true
			check_shrouded=true
			x,y=106,97
		[/sound_source]
		{PLAYER_MOVEMENT_RESET}
		{PLAYER_MOVEMENT_POINTS_0}
		{PLAYER_HEALTH_MAX}
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=3
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_2_sub_2_reached_camp
		[/remove_event]
	[/event]
	
	[event] ##########	Sub objective 3 (main 2): 1st wolf attack	##########
		id=main_2_sub_3_1st_wolf_attack
		
		##########	Trigger conditions	##########
		name=turn end
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=2
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=3
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		[remove_sound_source]
			id=campfire_1,campfire_2
		[/remove_sound_source]
		[AWaS_Create_Basic_Scenery]
			id=snowfall
			Scenery_Type=snowfall
			[filter_location]
				x=100
				y=100
				radius=40
			[/filter_location]
		[/AWaS_Create_Basic_Scenery]
		[lua] 
			code=<<  
				ToA_New_Scene_Start({Fast=false})
			>> 
		[/lua]
		[replace_schedule]
			{MIDNIGHT}	
		[/replace_schedule]
		{NAMED_GENERIC_UNIT 3 Wolf 110 96 wolf1 (Wolf)}
		{NAMED_GENERIC_UNIT 3 Wolf 108 95 wolf2 (Wolf)}
		{TELEPORT_UNIT (id=arnelda) 108 97}
		{TELEPORT_UNIT (id=gar) 106 96}
		{TELEPORT_UNIT (id=mudoc) 106 95}
		[terrain]
			x,y=106,97
			terrain=Aa
		[/terrain]
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/campfire_remains.png 106 97}	
		{COLOR_ADJUST -150 -150 -150}
		[lua] 
			code=<< 
				wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/howling-wolf-sound-fx_C_major.wav")
				ToA_New_Scene_Finish({Text="After nightfall", Text_Size=80, Map_Location_X=106, Map_Location_Y=97, Fast=false})
			>> 
		[/lua]	
		{SPEAK mudoc (_ "Wake up!")}
		{SPEAK mudoc (_ "Wolfs!")}
		[lua] 
			code=<<  wesnoth.interface.screen_fade({-255, -255, -255, 100}, 100)	>> 
		[/lua]
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=4
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_2_sub_3_1st_wolf_attack
		[/remove_event]
	[/event]
	
	[event] ##########	Sub objective 4 (main 2): 2nd wolf attack	##########
		id=main_2_sub_4_2nd_wolf_attack
		
		##########	Trigger conditions	##########
		name=last breath
		[filter]
			id=wolf1,wolf2
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=2
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=4
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		{NAMED_GENERIC_UNIT 3 Wolf 107 91 wolf_alpha (Wolf)}
		[lua] 
			code=<< 
				wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/howling-wolf-sound-fx_C_major.wav")
			>> 
		[/lua]
		{MOVE_UNIT (id=wolf_alpha) 106 94}
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=5
		[/set_variable]	

		##########	Clean up	##########
		[remove_event]
			id=main_2_sub_4_2nd_wolf_attack
		[/remove_event]
		
	[/event]
	
	[event] ##########	Main objective 2: Camp in the clearing, end	##########
		id=main_2_sub_4_wolfs_dead
		
		##########	Trigger conditions	##########
		name=die
		[filter]
			id=wolf1,wolf2,wolf_alpha
		[/filter]
		[filter_condition]
			[not]
				[have_unit]
					side=3
					id=wolf1,wolf2,wolf_alpha
				[/have_unit]
			[/not]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Main_Objective_Counter
					numerical_equals=2
				[/variable]
			[/and]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=5
				[/variable]
			[/and]
		[/filter_condition]	
		
				
		##########	Scene setting/animation	##########
		{SPEAK arnelda (_ "That seems to be all of them.")}
		[lua] 
			code=<< ToA_New_Scene_Start({Fast=false}) >>
		[/lua]
		{PLAYER_FULL_RESTORE}
		[terrain]
			x,y=106,96
			terrain=Aa
		[/terrain]
		[terrain]
			x,y=107,98
			terrain=Aa
		[/terrain]
		
		##########	Clean up	##########
		[remove_event]
			id=main_2_sub_4_wolfs_dead, main_2_sub_3_1st_wolf_attack, main_2_sub_2_reached_camp, main_2_sub_1_Banter
		[/remove_event]
		[remove_item]
			x,y=107,98
			image=data/core/images/terrain/village/camp3.png
		[/remove_item]
		[remove_item] 
			x,y=106,96
			image=data/core/images/terrain/village/camp2.png
		[/remove_item]
		
		##########	Handle objectives	##########
		[fire_event] #next objective event will be triggerd here
			name=main_3_Scout_North_start
		[/fire_event]

	[/event]	
	
	[event] ##########	Main objective 3: Scout the north, start	##########
		id=main_3_Scout_North_start
	
		##########	Trigger conditions	##########
		name=main_3_Scout_North_start
		
		##########	Scene setting: animating	##########
		{TELEPORT_UNIT (id=arnelda) 106 96}
		{TELEPORT_UNIT (id=gar) 106 96}
		{TELEPORT_UNIT (id=mudoc) 106 96}
		{TELEPORT_UNIT (id=merissa) 106 96}
		[modify_unit]
			[filter]
				side=1
				[filter_location]
					x,y=106,96
					radius=3
				[/filter_location]
			[/filter]
			moves=6
		[/modify_unit]
		[replace_schedule]
			{DAWN}	
		[/replace_schedule]
		[redraw]
			clear_shroud=yes
		[/redraw]
		{COLOR_ADJUST 0 0 0}
		[lua] 
			code=<< 
				ToA_New_Scene_Finish({Text="Next morning", Text_Size=80, Map_Location_X=106, Map_Location_Y=96, Fast=false})
			>> 
		[/lua]
		{SPEAK arnelda (_ "We will scout the north and then circle back to the coast.")}
		
		##########	Handle objectives: 	##########
		[remove_shroud] # removes the shroud on the new goal
			side=1
			x,y=100,80
			radius=1
		[/remove_shroud]
		{HIGHLIGHT_IMAGE 100 80 "items/gohere.png" ()}
		[objectives]
			{OBJECTIVE ( _ "Scout northwards") (win)}
			{DEFEAT_OBJECTIVE}
			{SECRETS_NOTE}
			[note]
				description=_"All experience mechanics are disabeled"
			[/note]
			[note]
				description=_"The death of non-loyal units have no impact"
			[/note]
		[/objectives]
		[set_variable]
			name=ToA.Scenario_Specific.Main_Objective_Counter
			value=3
		[/set_variable]
		[set_variable]
            name=ToA.Scenario_Specific.Sub_Objective_Counter
            value=1
        [/set_variable]
		
		##########	Clean up	##########
		[remove_event]
			id=main_3_Scout_North_start
		[/remove_event]
	[/event]

	[event] ##########	Sub objective 1 (main 3): banter 2	##########
		id=main_3_sub_1_Banter
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=106,89
				radius=2
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=3
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=1
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		{SPEAK merissa (_ "It is a strange feeling, to wake up so far from home.")}
		{SPEAK arnelda (_ "Home is where the heart is.")}
		{SPEAK arnelda (_ "If you let it, you will have what I had.")}
		{SPEAK merissa (_ "(<i>Steps forward and gives Arnelda a hug.</i>)")}
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=2
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_3_sub_1_Banter
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 2 (main 3): hear fightning	##########
		id=main_3_sub_2_hear_fighting
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=100,80
				radius=8
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=3
			[/variable]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		[remove_item] # remove the go here sign from the map
			x,y=100,80
			image=items/gohere.png
		[/remove_item]
		[unit]
			{CHARACTER_STATS_SODRY}
			facing="s"
			x,y=99,82
			side=5
		[/unit]
		{CHARACTER_UPGRADE_SODRY}
		{NAMED_GENERIC_UNIT 3 (Cave Bear) 99 81 bear1 (Hungry Bear)}
		[modify_unit]
			[filter]
				id=bear1
			[/filter]
			max_hitpoints=192
			hitpoints=149
		[/modify_unit]
		{NAMED_GENERIC_UNIT 5 Woodsman 100 80 hunter1 (Northen hunter)}
		{NAMED_GENERIC_UNIT 5 Woodsman 100 80 hunter2 (Northen hunter)}
		[replace_schedule]
			{MORNING}	
		[/replace_schedule]
		{SPEAK merissa (_ "Wait.")}
		{SPEAK arnelda (_ "What?")}
		{SPEAK merissa (_ "I hear shouting ahead.")}
		{MOVE_UNIT (id=arnelda) 101 83}
		{MOVE_UNIT (id=gar) 102 82}
		{MOVE_UNIT (id=mudoc) 103 82}
		{MOVE_UNIT (id=merissa) 103 83}
		[redraw]
			clear_shroud=yes
		[/redraw]
		[modify_unit]
			[filter]
				side=1
				[filter_location]
					x,y=106,96
					radius=3
				[/filter_location]
			[/filter]
			moves=6
		[/modify_unit]
		{HARM bear1 sodry 5 ranged}
		{HARM bear1 hunter1 4 ranged}
		{HARM bear1 hunter2 4 ranged}
		{SPEAK arnelda (_ "Help them.")}
		{PLAYER_MOVEMENT_RESET}
		{PLAYER_MOVEMENT_POINTS_MAX}
		[modify_unit]
			[filter]
				side=5
				[filter_location]
					x,y=100,80
					radius=3
				[/filter_location]
			[/filter]
			side=1
		[/modify_unit]
		[modify_unit]
			[filter]
				side=1
				[filter_location]
					x,y=100,80
					radius=5
				[/filter_location]
			[/filter]
			moves=6
		[/modify_unit]
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=3
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_3_sub_2_hear_fighting
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 3 (main 3): bear dead	##########
		id=main_3_sub_3_bear_dead
		
		##########	Trigger conditions	##########
		name=die
		[filter]
            id=bear1
        [/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=3
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=3
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		{NAMED_GENERIC_UNIT 5 Woodsman 103 80 hunter3 (Northen hunter)}
		{SPEAK sodry (_ "So, who are you supposed to be?")}
		{SPEAK arnelda (_ "We have come from across the sea to settle these lands.")}
		{SPEAK mudoc (_ "And saving ungrateful weaklings is just what we do.")}
		{SPEAK sodry (_ "...")}
		{SPEAK sodry (_ "My village is also looking to live on these lands. And well..")}
		{SPEAK sodry (_ "This fight was easy, but there are Orcs somewhere near here.")}
		{SPEAK sodry (_ "I say we band together.")}
		{SPEAK arnelda (_ "Deal.")}
		{SPEAK sodry (_ "Elmir, go back to the village and guide them here.")}
		{SPEAK hunter3 (_ "Will do. Expect us in a moon.")}
		{MOVE_UNIT (id=hunter3) 100 70}
		[kill]
			id=hunter3
		[/kill]
		{SPEAK sodry (_ "We have a camp nearby, let us talk further there.")}
		
		##########	Handle objectives	##########
		[replace_schedule]
			{AFTERNOON}	
		[/replace_schedule]
		[remove_shroud] # removes the shroud on the new goal
			side=1
			x,y=91,85
			radius=1
		[/remove_shroud]
		{HIGHLIGHT_IMAGE 91 85 "items/gohere.png" ()}
		[objectives]
			{OBJECTIVE ( _ "Settle for discussion") (win)}
			{DEFEAT_OBJECTIVE}
			{SECRETS_NOTE}
			[note]
				description=_"All experience mechanics are disabeled"
			[/note]
			[note]
				description=_"The death of non-loyal units have no impact"
			[/note]
		[/objectives]
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=4
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_3_sub_3_bear_dead
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 4 (main 3): Secret sword part 4	##########
		id=main_3_sub_4_Secret_Sword_4
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=90,86
				radius=5
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=3
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=4
				[/variable]
			[/and]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Secrets_Ghost_Count
					numerical_equals=1
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		[lua] 
			code=<< ToA_New_Scene_Start({Fast=true})  >> 
		[/lua]
		[replace_schedule]
			{DUSK}	
		[/replace_schedule]
		{TELEPORT_UNIT (id=arnelda) 97 85}
		{TELEPORT_UNIT (id=gar) 97 85}
		{TELEPORT_UNIT (id=mudoc) 97 85}
		{TELEPORT_UNIT (id=merissa) 97 85}
		{TELEPORT_UNIT (id=sodry) 97 85}
		{TELEPORT_UNIT (id=hunter1) 97 85}
		{TELEPORT_UNIT (id=hunter2) 97 85}
		{NAMED_GENERIC_UNIT 3 Icemonax 91 85 Icemonax (Supply thief)}
		{PLAYER_FACE_HEX 1}
		{PLAYER_MOVEMENT_POINTS_MAX}
		{PLAYER_MOVEMENT_RESET}
		[scroll_to]
			x,y=93,86
			immediate=yes
		[/scroll_to]
		[remove_shroud]
			side=1
			x,y=93,87
			radius=3
		[/remove_shroud]
		[redraw]
			clear_shroud=yes
		[/redraw]
		[lua] 
			code=<< ToA_New_Scene_Finish({Text="", Text_Size=30, Map_Location_X=96, Map_Location_Y=85, Fast=true})  wesnoth.interface.delay(1000) >> 
		[/lua]
		{SPEAK arnelda (_ "What is that thing?")}
		{MOVE_UNIT (id=Icemonax) 97 96}
		[kill]
			id=Icemonax
		[/kill]
		{SPEAK sodry (_ "Something that has been raiding our supplies.")}
		{SPEAK sodry (_ "I would very much like to hunt it down.")}
		
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=5
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_3_sub_4_Secret_Sword_4
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 5 (main 3): Secret sword part 5	##########
		id=main_3_sub_5_Secret_Sword_5
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=96,93
				radius=4
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=3
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=5
				[/variable]
			[/and]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Secrets_Ghost_Count
					numerical_equals=1
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		[replace_schedule]
			{DUSK}	
		[/replace_schedule]
		{SPEAK sodry (_ "Tracks lead south.")}
		{NAMED_GENERIC_UNIT 3 Icemonax 96 96 Icemonax (Supply thief)}
		{PLAYER_MOVE_TO 96 93}
		{PLAYER_MOVEMENT_POINTS_MAX}
		{PLAYER_MOVEMENT_RESET}
		[scroll_to]
			x,y=96,96
			immediate=yes
		[/scroll_to]
		[remove_shroud]
			side=1
			x,y=96,96
			radius=3
		[/remove_shroud]
		[redraw]
			clear_shroud=yes
		[/redraw]
		{SPEAK sodry (_ "Got you.")}
		[lua] 
			code=<<	
				AWaS_Color_Change_And_Tremble_Over_Time(300, {{1,10,0,0,0}})
			>>
		[/lua]
		{SPEAK gar (_ "Not this again.")}
		[lua] 
			code=<<	
				wesnoth.interface.add_hex_overlay(96, 96, {halo = "data/add-ons/Town_of_Arnsreach_Resources_1/images/spells/Force_Wave_Custom_Animation/[1~9].png:100, data/add-ons/Town_of_Arnsreach_Resources_1/images/spells/Force_Wave_Custom_Animation/[9].png:1000"})
				AWaS_Color_Change_And_Tremble_Over_Time(680, {{0.1,2,50,50,50}, {0.2,10,200,200,200}, {0.4,2,50,50,50}})
				wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/490253__anomaex__sci-fi_explosion_cut.wav")
			>>
		[/lua]
		[kill]
			id=Icemonax
		[/kill]
		{NAMED_GENERIC_UNIT 3 (Wraith) 96 96 SwordGhost (Wraith)}
		[modify_unit]
			[filter]
				id=SwordGhost
			[/filter]
			max_hitpoints=131
			hitpoints=131
		[/modify_unit]
		[label]
			x,y=97,95
			text= _ "Promised Spring"
		[/label]
		[lua] 
			code=<<	
				AWaS_Color_Change_And_Tremble_Over_Time(200, {{0,2,50,50,50}})
				wesnoth.interface.remove_hex_overlay(96, 96, "data/add-ons/Town_of_Arnsreach_Resources_1/images/spells/Force_Wave_Custom_Animation/[1~9].png:100, data/add-ons/Town_of_Arnsreach_Resources_1/images/spells/Force_Wave_Custom_Animation/[9].png:1000")
			>>
		[/lua]
		{SPEAK SwordGhost (_ "...can you wield...")}
		{SPEAK SwordGhost (_ "...despair?")}
		#sword name: promised despair
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=6
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_3_sub_5_Secret_Sword_5
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 6 (main 3): Secret Sword part 6	##########
		id=main_3_sub_6_Secret_Sword_6
		
		##########	Trigger conditions	##########
		name=die
		[filter]
            id=SwordGhost
        [/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=3
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=6
				[/variable]
			[/and]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Secrets_Ghost_Count
					numerical_equals=1
				[/variable]
			[/and]
		[/filter_condition]
		{PLACE_IMAGE data/core/images/items/sword.png $unit.x $unit.y}
		{SPEAK arnelda (_ "The sword remains.")}
		{SPEAK merissa (_ "It has an imbedded necrotic binding.")}
		{SPEAK merissa (_ "Nothing too horrible, just some prolonged misery to those it slays.")}
		{SPEAK mudoc (_ "...Well, you are the sword guy. (<i>Nods at Gar.</i>)")}
		{MOVE_UNIT (id=gar) $unit.x $unit.y}
		{REMOVE_IMAGE $unit.x $unit.y}
		{TOA_DESPAIR_SWORD gar}
		[set_variable]
			name=ToA.Characters.Gar.Sword
			value=true
		[/set_variable]
		[lua] 
			code=<< ToA_New_Scene_Start({Fast=true})  >> 
		[/lua]
		{PLAYER_TELEPORT_TO 94 86}
		[redraw]
			clear_shroud=yes
		[/redraw]
		[lua] 
			code=<< ToA_New_Scene_Finish({Text="", Text_Size=30, Map_Location_X=94, Map_Location_Y=86, Fast=true})  wesnoth.interface.delay(1000) >> 
		[/lua]
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=7
		[/set_variable]
		[set_variable]
			name=ToA.Scenario_Specific.Secrets_Counter
			add=1
		[/set_variable]
		[set_variable]
			name=ToA.Scenario_Specific.Secrets_Ghost_Count
			value=2
		[/set_variable]
		[lua] 
			code=<< wesnoth.interface.add_overlay_text(_"A secret found", {location={0,0}, duration=3000, valign="center", halign="center", size=30, color={150,150,150}, fade_time=1000}) >> 
		[/lua]		
		
		##########	Clean up	##########
		[remove_event]
			id=main_3_sub_6_Secret_Sword_6
		[/remove_event]
	[/event]
	
	[event] ##########	Main objective 3: Scout the north, end	##########
		id=main_3_Scout_North_end
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=91,85
				radius=1
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=3
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					greater_than=2
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		[remove_item] # remove the go here sign from the map
			x,y=91,85
			image=items/gohere.png
		[/remove_item]
		{SPEAK gar (_ "A house made of snow.")}
		{SPEAK mudoc (_ "I usually prefer the cold to be outside of my shelters.")}
		{SPEAK hunter2 (_ "It is warmer than it looks.")}
		{SPEAK sodry (_ "Make yourselves at home, and let us make a plan.")}
		{COLOR_ADJUST 0 0 0}
		[lua] 
			code=<< 
				ToA_New_Scene_Start({Fast=false}) 
				wesnoth.interface.delay(500) 
			>> 
		[/lua]
		[AWaS_Delete_Basic_Scenery]
			id=snowfall
		[/AWaS_Delete_Basic_Scenery]
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=6
		[/set_variable]
		[fire_event]
			name=main_4_Prepare_Arrival_start
		[/fire_event]		
		
		##########	Clean up	##########
		[remove_event]
			id=main_3_Scout_North_end, main_3_sub_1_Placeholder, main_3_sub_2_hear_fighting, main_3_sub_3_bear_dead, main_3_sub_4_Placeholder
		[/remove_event]	
	[/event]

	[event] ##########	Main objective 4: Prepare for arrival, start	##########
		id=main_4_Prepare_Arrival_start	
		name=main_4_Prepare_Arrival_start
	
		##########	Scene setting: animating	##########
		[if]
			[variable]
				name=ToA.Campaign_General.Debug_On
				boolean_equals=true
			[/variable]
			[then]
				[unit]
					{CHARACTER_STATS_SODRY}
					facing="s"
					x,y=99,82
					side=1
				[/unit]
				{CHARACTER_UPGRADE_SODRY}
				{NAMED_GENERIC_UNIT 1 Woodsman 100 80 hunter1 (Northen hunter)}
				{NAMED_GENERIC_UNIT 1 Woodsman 100 80 hunter2 (Northen hunter)}
			[/then]
		[/if]
		
		{TELEPORT_UNIT (id=arnelda) 90 86}
		{TELEPORT_UNIT (id=gar) 91 87}
		{TELEPORT_UNIT (id=mudoc) 92 87}
		{TELEPORT_UNIT (id=merissa) 92 86}
		{TELEPORT_UNIT (id=sodry) 90 85}
		{TELEPORT_UNIT (id=hunter1) 89 86}
		{TELEPORT_UNIT (id=hunter2) 91 86}
		[modify_unit]
			[filter]
				side=1
				[filter_location]
					x,y=91,86
					radius=3
				[/filter_location]
			[/filter]
			moves=6
		[/modify_unit]
		[replace_schedule]
			{DAWN}	
		[/replace_schedule]
		[redraw]
			clear_shroud=yes
		[/redraw]
		[lua] 
			code=<< 
				ToA_New_Scene_Finish({Text="Next morning", Text_Size=80, Map_Location_X=91, Map_Location_Y=87, Fast=false})
			>> 
		[/lua]
		{SPEAK arnelda (_ "Scouting is done, now we prepare for our people.")}
		
		##########	Handle objectives: 	##########
		[remove_shroud]
			side=1
			x,y=74,100
			radius=1
		[/remove_shroud]
		{HIGHLIGHT_IMAGE 74 100 "items/gohere.png" ()}
		[objectives]
			{OBJECTIVE ( _ "Prepare for arrival") (win)}
			{DEFEAT_OBJECTIVE}
			{SECRETS_NOTE}
			[note]
				description=_"All experience mechanics are disabeled"
			[/note]
			[note]
				description=_"The death of non-loyal units have no impact"
			[/note]
		[/objectives]
		[set_variable]
			name=ToA.Scenario_Specific.Main_Objective_Counter
			value=4
		[/set_variable]
		[set_variable]
            name=ToA.Scenario_Specific.Sub_Objective_Counter
            value=1
        [/set_variable]
		
		##########	Clean up	##########
		[remove_event]
			id=main_4_Prepare_Arrival_start
		[/remove_event]
	[/event]

	[event] ##########	Sub objective 1 (main 4): banter 3	##########
		id=main_4_sub_1_banter_3
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=86,92
				radius=4
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=4
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=1
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		{SPEAK gar (_ "Where are you from Sodry?")}
		{SPEAK sodry (_ "All over.")}
		{SPEAK gar (_ "And most recently?")}
		{SPEAK sodry (_ "I small village in the frozen north, one week on foot from here.")}
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=2
		[/set_variable]				
		
		##########	Clean up	##########
		[remove_event]
			id=main_4_sub_1_banter_3
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 2 (main 4): quest setup	##########
		id=main_4_sub_2_Quest_Setup
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=81,95
				radius=4
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=4
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=2
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		[remove_item] # remove the go here sign from the map
			x,y=74,100
			image=items/gohere.png
		[/remove_item]
		{SPEAK arnelda (_ "We need to gather food and prepare a place for the ship to dock.")}
		{SPEAK arnelda (_ "There are plenty of wild animals to hunt, and trees grow close to the coast.")}
		[modify_side]
			side=7
			team_name=Wilderness_alliance, Undead_alliance, Orc_alliance
        [/modify_side]
		{PLAYER_MOVEMENT_RESET}
		{PLAYER_MOVEMENT_POINTS_MAX}
		
		##########	Handle objectives	##########
		[remove_shroud]
			side=1
			x,y=78,101
			radius=1
		[/remove_shroud]
		{HIGHLIGHT_IMAGE 78 101 "items/gohere.png" ()}
		{SPEAK arnelda (_ "We should also move the rowboat")}
		[remove_shroud]
			side=1
			x,y=77,92
			radius=1
		[/remove_shroud]
		{HIGHLIGHT_IMAGE 77 92 "items/gohere.png" ()}
		[objectives]
			{OBJECTIVE ( _ "Prepare for arrival: 
	Hunt down 3 animals 
	Chop wood for camp building materiels 
	Relocate the rowboat to the new camp") (win)}
			{DEFEAT_OBJECTIVE}
			{SECRETS_NOTE}
			[note]
				description=_"All experience mechanics are disabeled"
			[/note]
			[note]
				description=_"The death of non-loyal units have no impact"
			[/note]
		[/objectives]
		[set_variable]
			name=killed_animal_count
			value=0
		[/set_variable]	
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=3
		[/set_variable]	
		
		##########	Clean up	##########
		[remove_event]
			id=main_4_sub_2_Quest_Setup
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 3-5 (main 4): hunt game	##########
		id=main_4_sub_3to5_hunt_game
		first_time_only=no
		
		##########	Trigger conditions	##########
		name=die
		[filter]
            side=7
        [/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=4
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					greater_than=2
				[/variable]
			[/and]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					less_than=6
				[/variable]
			[/and]
		[/filter_condition]
		[set_variable]
			name=killed_animal_count
			add=1
		[/set_variable] 
		[if]
			[variable]
				name=killed_animal_count
				numerical_equals=3
			[/variable]
			[then]
			
				##########	Scene setting: animate scene	##########
				{SPEAK arnelda (_ "We have enough to last us a while")}
				
				##########	Handle objectives	##########
				[modify_side]
					side=7
					team_name=Wilderness_alliance, Undead_alliance, Player_alliance, Orc_alliance
				[/modify_side]
				[set_variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					add=1
				[/set_variable] 
				[fire_event]
					name=main_4_Prepare_Arrival_end
				[/fire_event]		
				
				##########	Clean up	##########
				[remove_event]
					id=main_4_sub_3to5_hunt_game
				[/remove_event]	
			[/then]
		[/if]	
	[/event]
	
	[event] ##########	Sub objective 3-5 (main 4): chop wood	##########
		id=main_4_sub_3to5_chop_wood
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=78,101
				radius=0
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=4
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					greater_than=2
				[/variable]
			[/and]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					less_than=6
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		[lua] 
			code=<<
				wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/chopping-a-tree-with-hatchet-in-a-forest-close-up-68478.ogg")
				ToA_New_Scene_Start({Fast=true})
				wesnoth.interface.delay(1000)
				local Unit=wesnoth.units.get(78, 101)
				wesnoth.wml_actions.teleport({wml.tag.filter{id = Unit.id},x=77,y=101})				
			>> 
		[/lua]
		[remove_item] # remove the go here sign from the map
			x,y=78,101
			image=items/gohere.png
		[/remove_item]
		[terrain]
			x,y=78,101
			terrain=Aa
		[/terrain]
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/tree_stumps_1_snow.png 78 101}
		[lua] 
			code=<<
				ToA_New_Scene_Finish({Text="", Text_Size=40, Map_Location_X=78, Map_Location_Y=101, Fast=true})			
			>> 
		[/lua]
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			add=1
		[/set_variable] 
		[fire_event]
			name=main_4_Prepare_Arrival_end
		[/fire_event]		
		
		##########	Clean up	##########
		[remove_event]
			id=main_4_sub_3to5_chop_wood
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 3-5 (main 4): relocate rowboat	##########
		id=main_4_sub_3to5_relocate_boat
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=77,92
				radius=0
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=4
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					greater_than=2
				[/variable]
			[/and]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					less_than=6
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		[lua] 
			code=<<
				wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/rumor-sound-sea-foam_92bpm.wav")
				ToA_New_Scene_Start({Fast=true})
				wesnoth.interface.delay(1000)
				local Unit=wesnoth.units.get(77, 92)
				Unit.moves=0
				wesnoth.wml_actions.teleport({wml.tag.filter{id = Unit.id},x=73,y=101})					
			>> 
		[/lua]
		[remove_item]
			x,y=77,92
			image=items/gohere.png
		[/remove_item]
		[remove_item]
			x,y=76, 91
			image="data/core/images/units/transport/boat.png~ROTATE(-20)"
		[/remove_item]
		{PLACE_IMAGE data/core/images/units/transport/boat.png 72 100}
		[lua] 
			code=<<
				ToA_New_Scene_Finish({Text="", Text_Size=40, Map_Location_X=74, Map_Location_Y=100, Fast=true})			
			>> 
		[/lua]
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			add=1
		[/set_variable] 
		[fire_event]
			name=main_4_Prepare_Arrival_end
		[/fire_event]		
		
		##########	Clean up	##########
		[remove_event]
			id=main_4_sub_3to5_relocate_boat
		[/remove_event]	
	[/event]

	[event] ##########	Main objective 4: Prepare for arrival, end	##########
		id=main_4_Prepare_Arrival_end
		
		##########	Trigger conditions	##########
		name=main_4_Prepare_Arrival_end
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=4
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=6
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		[lua] 
			code=<<
				ToA_New_Scene_Start({Fast=false})	
			>> 
		[/lua]
		[terrain]
			x,y=73,100
			terrain=Wog^Bw\
		[/terrain]
		[terrain]
			x,y=74,100
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=74,101
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=74,100
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=75,102
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=76,101
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=76,100
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=77,100
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=77,99
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=75,101
			terrain=Rb^Ecf
		[/terrain]
		{PLACE_IMAGE data/core/images/terrain/village/igloo3.png 76 99}
		{PLACE_IMAGE data/core/images/terrain/village/orc-snow.png 75 100}
		{PLACE_IMAGE data/core/images/terrain/village/camp.png 77 99}
		{PLACE_IMAGE data/core/images/terrain/village/camp3.png 77 101}
		{PLACE_IMAGE data/core/images/scenery/leanto.png 75 102}
		{PLACE_IMAGE data/core/images/scenery/trash.png 78 100}
		{TELEPORT_UNIT (id=arnelda) 77 100}
		{TELEPORT_UNIT (id=gar) 75 99}
		{TELEPORT_UNIT (id=mudoc) 76 98}
		{TELEPORT_UNIT (id=merissa) 77 101}
		{TELEPORT_UNIT (id=sodry) 83 103}
		{TELEPORT_UNIT (id=hunter1) 82 103}
		{TELEPORT_UNIT (id=hunter2) 74 97}
		[lua] 
			code=<<
				ToA_New_Scene_Finish({Text="Two weeks later", Text_Size=80, Map_Location_X=74, Map_Location_Y=100, Fast=true})			
			>> 
		[/lua]
		[redraw]
			clear_shroud=yes
		[/redraw]		
		[delay]
			time=2000
		[/delay]
		{TOA_ADD_PROSPERITY 14}
		[delay]
			time=2000
		[/delay]
		{SPEAK gar (_ "I see something")}
		{MOVE_UNIT (id=gar) 73 100}
		{SPEAK gar (_ "They are here!")}
		[unit]
			id=Ship
			side=2
			name=_"Ship"
			type="Galleon"
			canrecruit=no
			facing="e"
			x,y=55,96
		[/unit]
		{MOVE_UNIT (id=Ship) 72 99}
		{MOVE_UNIT (id=gar) 76 101}
		{MOVE_UNIT (id=arnelda) 74 100}
		{NAMED_GENERIC_UNIT 2 (Alderman Eskil) 73 100 village_elder (Alderman Eskil)}
		{SPEAK arnelda (_ "Welcome to your new home, Alderman.")}
		{SPEAK village_elder (_ "Damn if it doesn't feel great with solid ground to stand on.")}
		{SPEAK village_elder (_ "We are all eager to see this new home of ours.")}
		{SPEAK arnelda (_ "Let me show you around")}
		{MOVE_UNIT (id=arnelda) 81 99}
		{MOVE_UNIT (id=village_elder) 80 99}
		{NAMED_GENERIC_UNIT 2 (Peasant) 73 100 villager_1 (Villager)}
		{REMOVE_IMAGE 75 102}
		{PLACE_IMAGE data/core/images/items/barrel.png 75 102}
		{PLACE_IMAGE data/core/images/scenery/leanto.png 75 102}
		{MOVE_UNIT (id=villager_1) 75 102}
		[delay]
			time=500
		[/delay]
		{MOVE_UNIT (id=villager_1) 81 100}
		{NAMED_GENERIC_UNIT 2 (Peasant) 73 100 villager_2 (Villager)}
		{MOVE_UNIT (id=villager_2) 74 101}
		{NAMED_GENERIC_UNIT 2 (Peasant) 73 100 villager_3 (Villager)}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/box.png 74 101}
		[delay]
			time=500
		[/delay]
		{MOVE_UNIT (id=villager_2) 81 100}
		{MOVE_UNIT (id=sodry) 77 102}
		{SPEAK sodry (_ "What is in the box?")}
		{SPEAK gar (_ "Valuables, mostly spices and the family jewels.")}
		{SPEAK merissa (_ "Thus the soft voice.")}
		{SPEAK gar (_ "What?")}
		{SPEAK sodry (_ "(<i>Eyes glimmering, a rare smile behind them.</i>)")}
		{TOA_ADD_POPULATION 82}
		[delay]
			time=3000
		[/delay]
		
		[lua] 
			code=<<
				ToA_New_Scene_Start({Fast=false})			
			>> 
		[/lua]
		{REMOVE_IMAGE 75 100}
		{REMOVE_IMAGE 77 99}
		{REMOVE_IMAGE 77 101}
		{REMOVE_IMAGE 75 102}
		{REMOVE_IMAGE 74 101}
		[remove_item]
			x,y=106,97
			image=data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/campfire_unlit.png
		[/remove_item]
		[terrain]
			x,y=75,101
			terrain=Rb
		[/terrain]
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=7
		[/set_variable]
		[fire_event]
			name=main_5_Bitter_Taste_start
		[/fire_event]		
		
		##########	Clean up	##########
		[remove_event]
			id=main_4_Prepare_Arrival_end, main_4_sub_1_banter_3,  main_4_sub_2_Quest_Setup, main_4_sub_3to5_chop_wood, main_4_sub_3to5_hunt_game, main_4_sub_3to5_relocate_boat
		[/remove_event]	
	[/event]

	[event] ##########	Main objective 5: A bitter taste, start	##########
		id=main_5_Bitter_Taste_start
		name=main_5_Bitter_Taste_start
		
		##########	Scene setting	##########	
		[lua] 
			code=<< ToA_New_Scene_Start({Fast=false}) >> 
		[/lua]
		[if]
			[variable]
				name=ToA.Campaign_General.Debug_On
				boolean_equals=true
			[/variable]
			[then]
				[unit]
					{CHARACTER_STATS_SODRY}
					facing="s"
					x,y=99,82
					side=1
				[/unit]
				{CHARACTER_UPGRADE_SODRY}
				{NAMED_GENERIC_UNIT 1 Woodsman 100 80 hunter1 (Northen hunter)}
				{NAMED_GENERIC_UNIT 1 Woodsman 100 80 hunter2 (Northen hunter)}
			[/then]
		[/if]
		[replace_schedule]
			{AFTERNOON}	
		[/replace_schedule]
		[terrain]
			x,y=104,98
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=105,98
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=105,97
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=106,96
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=106,95
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=107,95
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=107,97
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=108,97
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=107,98
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=106,98
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=106,99
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=108,98
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=109,97
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=109,96
			terrain=Rb^Esa
		[/terrain]
		[terrain]
			x,y=106,97
			terrain=Rb^Ecf
		[/terrain]
		[terrain]
			x,y=106,100
			terrain=Rb^Esa
		[/terrain]
		[terrain]
			x,y=106,94
			terrain=Rb^Esa
		[/terrain]
		[terrain]
			x,y=105,100
			terrain=Aa
		[/terrain]
		[terrain]
			x,y=104,99
			terrain=Aa
		[/terrain]
		[terrain]
			x,y=103,99
			terrain=Aa
		[/terrain]
		[terrain]
			x,y=104,96
			terrain=Aa
		[/terrain]
		[terrain]
			x,y=109,99
			terrain=Aa
		[/terrain]
		[terrain]
			x,y=110,97
			terrain=Aa
		[/terrain]
		[terrain]
			x,y=110,96
			terrain=Aa
		[/terrain]
		[terrain]
			x,y=109,98
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=107,99
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=108,96
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=105,96
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=104,97
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=103,97
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=107,96
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=108,99
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=108,98
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=107,100
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=105,99
			terrain=Rb
		[/terrain]
		[terrain]
			x,y=109,96
			terrain=Rb^Voa
		[/terrain]
		[terrain]
			x,y=105,96
			terrain=Rb^Voa
		[/terrain]
		
		{PLACE_IMAGE data/core/images/terrain/village/camp.png 105 99}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/tree_stumps_2_snow.png 104 99}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/tree_stumps_3_snow.png 103 99}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/tree_stumps_3_snow.png 104 96}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/tree_stumps_1_snow.png 109 99}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/tree_stumps_2_snow.png 110 97}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/tree_stumps_1.png 107 99}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/tree_stumps_3_snow.png 110 96}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/tree_stumps_2.png 109 98}
		{PLACE_IMAGE data/core/images/terrain/village/camp2.png 104 97}
		{PLACE_IMAGE data/core/images/terrain/village/camp.png 103 97}
		{PLACE_IMAGE data/core/images/terrain/village/camp3.png 107 96}
		{PLACE_IMAGE data/core/images/terrain/village/camp3.png 108 99}
		{PLACE_IMAGE data/core/images/terrain/village/camp.png 107 100}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/tree_stumps_1_snow.png 105 100}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/log_pile.png 104 98}
		{PLACE_IMAGE data/core/images/items/barrel.png 107 101}
		{PLACE_IMAGE data/core/images/scenery/leanto.png 107 101}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/box.png 107 95}
		{PLACE_IMAGE data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/barrel_stack.png 108 97}
		[item]
			x,y=109,97
			image=data/add-ons/Town_of_Arnsreach_Resources_1/images/single_tile_items/log_pile.png~FL(horiz)
		[/item]
		[item]
			x,y=108,98
			image=data/core/images/terrain/village/camp2.png~FL(horiz)
		[/item]
		{NAMED_GENERIC_UNIT 2 (Peasant Workers) 111 97 villagers_1 (Villagers)}
		{NAMED_GENERIC_UNIT 2 (Peasant Workers) 102 98 villagers_2 (Villagers)}
		{NAMED_GENERIC_UNIT 2 (Alderman Eskil) 106 99 villager_1 (Alderman Eskil)}
		{NAMED_GENERIC_UNIT 2 (Peasant) 103 100 villager_2 (Villager)}
		{NAMED_GENERIC_UNIT 2 (Peasant) 108 96 villager_3 (Villager)}
		{TELEPORT_UNIT (id=arnelda) 107 97}
		{TELEPORT_UNIT (id=gar) 105 97}
		{TELEPORT_UNIT (id=mudoc) 106 98}
		{TELEPORT_UNIT (id=merissa) 108 100}
		{TELEPORT_UNIT (id=hunter2) 106 96}
		{TELEPORT_UNIT (id=hunter1) 102 94}
		{TELEPORT_UNIT (id=sodry) 109 95}
		[place_shroud]
			side=1
			x,y=100,88
			radius=4
		[/place_shroud]
		[redraw]
			clear_shroud=yes
		[/redraw]
		{PLAYER_FULL_RESTORE}
		[sound_source]
			id=campfire_1
			sounds="data/add-ons/Town_of_Arnsreach_Resources_1/sounds/campfire.wav"
			loop=-1
			full_range=3
			fade_range=5
			chance=100
			delay=0
			check_fogged=true
			check_shrouded=true
			x,y=106,97
		[/sound_source]
		[lua] 
			code=<< 				
				ToA_New_Scene_Finish({Text="A few weeks later", Text_Size=105,  Map_Location_X=106,  Map_Location_Y=97, Fast=false})
			>> 
		[/lua]
		
		##########	Scene animation	##########
		{TOA_ADD_PROSPERITY 43}
		[delay]
			time=2000
		[/delay]
		{NAMED_GENERIC_UNIT 5 (Peasant Workers) 106 88 northen1 (Northen Villagers)}
		{NAMED_GENERIC_UNIT 5 Peasant 106 88 northen2 (Northen Villager)}
		{NAMED_GENERIC_UNIT 5 Woodsman 106 88 hunter3 (Elmir)}
		{MOVE_UNIT (id=hunter3) 106 94}
		{MOVE_UNIT (id=northen2) 105 93}
		{MOVE_UNIT (id=northen1) 106 92}
		{SPEAK hunter3 (_ "Sodry!")}
		{TOA_ADD_POPULATION 21}
		[delay]
			time=1000
		[/delay]
		{MOVE_UNIT (id=sodry) 107 94}
		{SPEAK sodry (_ "Welcome to y-")}
		{SPEAK hunter3 (_ "Orc scout in the forest behind us!")}
		{SPEAK arnelda (_ "Gar, take charge and hunt it down. I will keep order here.")}
		[lua] 
			code=<< ToA_New_Scene_Start({Fast=true}) >> 
		[/lua]
		[modify_unit]
			[filter]
				id=arnelda
			[/filter]
			side=2
		[/modify_unit]
		[modify_unit]
			[filter]
				id=hunter3
			[/filter]
			side=1
		[/modify_unit]
		{PLAYER_TELEPORT_TO 107 95}
		{TELEPORT_UNIT (id=villager_1) 105 100}
		{TELEPORT_UNIT (id=villagers_1) 107 98}
		{TELEPORT_UNIT (id=northen1) 105 97}
		{TELEPORT_UNIT (id=northen2) 106 98}
		{TELEPORT_UNIT (id=villager_3) 105 98}
		[lua] 
			code=<< 
				ToA_New_Scene_Finish({Text="", Text_Size=105,  Map_Location_X=105,  Map_Location_Y=94, Fast=true})
			>> 
		[/lua]
		
		##########	Handle objectives: 	##########
		{HIGHLIGHT_IMAGE 100 84 "items/gohere.png" ()}
		[remove_shroud]
			side=1
			x,y=100,84
			radius=1
		[/remove_shroud]
		[objectives]
			{OBJECTIVE ( _ "Hunt to the north") (win)}
			{DEFEAT_OBJECTIVE}
			{SECRETS_NOTE}
			[note]
				description=_"All experience mechanics are disabeled"
			[/note]
			[note]
				description=_"The death of non-loyal units have no impact"
			[/note]
		[/objectives]
		[set_variable]
			name=ToA.Scenario_Specific.Main_Objective_Counter
			value=5
		[/set_variable]
		[set_variable]
            name=ToA.Scenario_Specific.Sub_Objective_Counter
            value=1
        [/set_variable]
		
		##########	Clean up	##########
		[remove_event]
			id=main_5_Bitter_Taste_start
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 1 (main 5): Fire	##########
		id=main_5_sub_1_Fire
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=102,87
				radius=5
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=5
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=1
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		{NAMED_GENERIC_UNIT 4 (Goblin Pillager low) 99 87 Gak (_ "Gak Gak")}
		{MOVE_UNIT (id=Gak) 103 89}
		{SPEAK Gak (_ "Gak Gak carries a gift, come!")}
		{MOVE_UNIT (id=Gak) 99 84}
		[kill]
			id=Gak
		[/kill]
		
		##wildfire
		[sound_source]
			id=wildfire_1
			sounds="data/add-ons/Animated_Weather_and_Scenery/sounds/inferno.wav"
			loop=-1
			full_range=5
			fade_range=10
			chance=100
			delay=0
			check_fogged=true
			check_shrouded=true
			x,y=99,90
		[/sound_source]
		[sound_source]
			id=wildfire_2
			sounds="data/add-ons/Animated_Weather_and_Scenery/sounds/inferno.wav"
			loop=-1
			full_range=5
			fade_range=10
			chance=100
			delay=0
			check_fogged=true
			check_shrouded=true
			x,y=99,87
		[/sound_source]
		[terrain]
			x,y=101,87
			terrain=Rb^Fdw
		[/terrain]
		[terrain]
			x,y=97,86
			terrain=Rb^Fdw
		[/terrain]
		[terrain]
			x,y=98,89
			terrain=Rb^Fdw
			radius=1
		[/terrain]
		[terrain]
			x,y=99,87
			terrain=Rb^Fdw
			radius=1
		[/terrain]
		[item]
			x,y=98,86
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:60
		[/item]
		[item]
			x,y=99,86
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:61
		[/item]
		[item]
			x,y=100,86
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:62
		[/item]
		[item]
			x,y=97,86
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:63
		[/item]
		[item]
			x,y=101,87
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:64
		[/item]
		[item]
			x,y=99,87
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:65
		[/item]
		[item]
			x,y=98,87
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:66
		[/item]
		[item]
			x,y=100,87
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:67
		[/item]
		[item]
			x,y=98,88
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:68
		[/item]
		[item]
			x,y=99,88
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:69
		[/item]
		[item]
			x,y=97,89
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:70
		[/item]
		[item]
			x,y=99,89
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:71
		[/item]
		[item]
			x,y=98,89
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:72
		[/item]
		[item]
			x,y=98,90
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:73
		[/item]
		[item]
			x,y=97,90
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:74
		[/item]
		[item]
			x,y=99,90
			halo=data/add-ons/Animated_Weather_and_Scenery/images/weather/inferno/00[01~15].png:75
		[/item]
		
		{PLAYER_MOVEMENT_RESET}
		{SPEAK sodry (_ "Smoke.")}
		
		##########	Handle objectives	##########
		[objectives]
			{OBJECTIVE ( _ "Deal with Gak Gaks gift (Step on it)") (win)}
			{DEFEAT_OBJECTIVE}
			{SECRETS_NOTE}
			[note]
				description=_"All experience mechanics are disabeled"
			[/note]
			[note]
				description=_"The death of non-loyal units have no impact"
			[/note]
		[/objectives]
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=2
		[/set_variable]
		[store_locations]
            x,y=98,89
			radius=1
            variable=wild_fire_extinguish_handler
            mode=append
        [/store_locations]
		[store_locations]
            x,y=99,87
			radius=1
            variable=wild_fire_extinguish_handler
            mode=append
        [/store_locations]
		[store_locations]
            x,y=97,86
            variable=wild_fire_extinguish_handler
            mode=append
        [/store_locations]
		[store_locations]
            x,y=101,87
            variable=wild_fire_extinguish_handler
            mode=append
        [/store_locations]
		[set_variable] ##########	Handle objectives	##########
			name=fire_count # if it reaches 16 Arnelda will be attack by goblins
			value=0
		[/set_variable]		
		
		##########	Clean up	##########
		[remove_event]
			id=main_5_sub_1_Fire
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 2 (main 5): extinguish 	##########
		id=main_5_sub_2_extinguish
		first_time_only=no
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				find_in=wild_fire_extinguish_handler
			[/filter_location]
			x,y=$x1,$y1
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=5
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=2
				[/variable]
			[/and]
		[/filter_condition]
		
		##########	Scene setting: animate scene	##########
		[remove_item]
			x,y=$x1, $y1
			halo="data/add-ons/Town_of_Arnsreach_Resources_1/images/weather/inferno/00[01~15].png:"
		[/remove_item]
		[item] #smoke effect for extinguish flames
			x,y=$x1,$y1
			halo="projectiles/muzzle-flash-[4~14].png:60"
		[/item]
		[delay]
			time=600
		[/delay]
		[remove_item]
			x,y=$x1,$y1
			halo="projectiles/muzzle-flash-[4~14].png:60"
		[/remove_item]
		[modify_unit]
			[filter]
				[filter_location]
					find_in=wild_fire_extinguish_handler
				[/filter_location]
				id=$unit.id
				side=1
			[/filter]
			moves=0
		[/modify_unit]

		
		##########	Handle objectives	##########
		[store_locations]
			find_in=wild_fire_extinguish_handler
			[not]
				x,y=$x1,$y1
			[/not]
			variable=wild_fire_extinguish_handler
		[/store_locations]
		[set_variable]
			name=fire_count
			add=1
		[/set_variable]
		[if]
			[variable]
				name=fire_count
				numerical_equals=16
			[/variable]
			[then]
				[remove_sound_source]
					id=wildfire_1,wildfire_2
				[/remove_sound_source]
				[set_variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					value=3
				[/set_variable]
				[fire_event]
					id=main_5_sub_3_return
				[/fire_event]
				[remove_item] # remove the go here sign from the map
					x,y=100,84
					image=items/gohere.png
				[/remove_item]
				[remove_event]
					id=main_5_sub_2_extinguish
				[/remove_event]	
			[/then]
		[/if]
	[/event]
	
	[event] ##########	Sub objective 3 (main 5): return 	##########
		id=main_5_sub_3_return
		
		##########	Trigger conditions	##########
		name=main_5_sub_3_return
		
		##########	Scene setting/animation	##########
		[lua] 
			code=<< ToA_New_Scene_Start({Fast=true}) >> 
		[/lua]
		[replace_schedule]
			{MIDNIGHT}	
		[/replace_schedule]
		[modify_side]
			side=2
			share_vision="none"
		[/modify_side]
		[modify_side]
			side=5
			share_vision="none"
		[/modify_side]
		{PLAYER_TELEPORT_TO 100 90}
		{TELEPORT_UNIT (id=villager_1) 104 100}
		{TELEPORT_UNIT (id=villagers_1) 102 99}
		{TELEPORT_UNIT (id=northen1) 102 99}
		{TELEPORT_UNIT (id=northen2) 102 99}
		{TELEPORT_UNIT (id=villager_3) 102 99}
		{TELEPORT_UNIT (id=arnelda) 111 98}
		{PLAYER_FULL_RESTORE}
		[redraw]
			clear_shroud=yes
		[/redraw]
		[lua] 
			code=<< 
				ToA_New_Scene_Finish({Text="", Text_Size=105,  Map_Location_X=100,  Map_Location_Y=90, Fast=true})
			>> 
		[/lua]
		[sound_source]
			id=crowd_screaming
			sounds="data/add-ons/Town_of_Arnsreach_Resources_1/sounds/crowd_panic_screaming.wav"
			loop=-1
			full_range=3
			fade_range=12
			chance=100
			delay=0
			check_fogged=false
			check_shrouded=false
			x,y=106,99
		[/sound_source]
		{SPEAK mudoc (_ "...I hear screaming.")}
		{SPEAK merissa (_ "It is coming from the village!")}
		
		##########	Handle objectives	##########
		[objectives]
			{OBJECTIVE ( _ "Rush back to defend the village") (win)}
			{DEFEAT_OBJECTIVE}
			{SECRETS_NOTE}
			[note]
				description=_"All experience mechanics are disabeled"
			[/note]
			[note]
				description=_"The death of non-loyal units have no impact"
			[/note]
		[/objectives]
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=4
		[/set_variable]
		
		##########	Clean up	##########
		[remove_event]
			id=main_5_sub_3_return
		[/remove_event]	
	[/event]
	
	[event] ##########	Sub objective 4 (main 5): battle 	##########
		id=main_5_sub_4_battle
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=111,98
				radius=7
			[/filter_location]
		[/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=5
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=4
				[/variable]
			[/and]
		[/filter_condition]
		##########	Scene setting/animation	##########
		{NAMED_GENERIC_UNIT 4 (Goblin Spearman) 111 99 goblin_1 (_ "Goblin Spearman")}
		{NAMED_GENERIC_UNIT 4 (Goblin Spearman) 112 98 goblin_2 (_ "Goblin Spearman")}
		{NAMED_GENERIC_UNIT 4 (Goblin Spearman) 112 97 goblin_3 (_ "Goblin Spearman")}
		{NAMED_GENERIC_UNIT 4 (Goblin Spearman) 111 97 goblin_4 (_ "Goblin Spearman")}
		{NAMED_GENERIC_UNIT 4 (Orcish Leader) 113 99 goblin_5 (_ "Orcish Leader")}
		{NAMED_GENERIC_UNIT 4 (Orcish Archer) 113 98 goblin_6 (_ "Orcish Archer")}
		{NAMED_GENERIC_UNIT 4 (Goblin Spearman) 114 98 goblin_7 (_ "Goblin Spearman")}
		{NAMED_GENERIC_UNIT 4 (Wolf Rider) 113 97 goblin_8 (_ "Wolf Rider")}
		
		{PLAYER_FULL_RESTORE}
		[remove_shroud]
			x,y=109,98
			radius=8
		[/remove_shroud]
		[lift_fog]
			[filter_side]
				side=1
			[/filter_side]
			x,y=109,98
			radius=4
			multiturn=no
		[/lift_fog]
		[redraw]
			clear_shroud=yes
		[/redraw]
		{SPEAK gar (_ "Attack!")}
		{HARM arnelda goblin_1 6 ranged}
		
		{MOVE_UNIT (id=gar) 105 96}
		{MOVE_UNIT (id=hunter1) 106 95}
		{MOVE_UNIT (id=hunter2) 107 95}
		{MOVE_UNIT (id=mudoc) 104 96}
		{MOVE_UNIT (id=sodry) 104 97}
		{MOVE_UNIT (id=merissa) 103 97}
		{MOVE_UNIT (id=hunter3) 104 95}
		{SPEAK goblin_2 (_ "Hah! the dummys return.")}
		{HARM arnelda goblin_2 6 melee}
		{HARM arnelda goblin_3 6 melee}
		{HARM arnelda goblin_4 6 melee}
		{HARM goblin_4 arnelda 20 melee}
		{SPEAK goblin_5 (_ "Weaklins fitin weaklins, fun watch.")}
		{MOVE_UNIT (id=gar) 107 97}
		{MOVE_UNIT (id=hunter1) 108 96}
		{MOVE_UNIT (id=hunter2) 109 96}
		{MOVE_UNIT (id=mudoc) 107 98}
		{MOVE_UNIT (id=sodry) 107 99}
		{MOVE_UNIT (id=merissa) 106 98}
		{MOVE_UNIT (id=hunter3) 106 96}
		{PLAYER_FULL_RESTORE}
		{SPEAK goblin_1 (_ "Me goin get ya!")}
		{HARM arnelda goblin_2 6 melee}
		{HARM arnelda goblin_3 6 melee}
		{HARM arnelda goblin_1 6 ranged}
		{HARM arnelda goblin_1 6 ranged}
		{HARM goblin_3 arnelda 20 melee}
		{HARM arnelda goblin_2 6 melee}
		{HARM goblin_2 arnelda 20 ranged}
		{SPEAK goblin1 (_ "You do not kill me!")}
		{HARM arnelda goblin_1 10 ranged}
		{SPEAK narrator (_ "(<i>Falls over with a spear run through her abdomen.</i>)")}
		[kill]
			id=arnelda
			animate=yes
		[/kill]
		[item] ### Arnelda Corpse ### Todo
			x,y=111,98
			image="units/human-outlaws/thief+female-die-7.png"
		[/item]
		{SPEAK goblin_5 (_ "Watching is fun, doing... funnier.")}
		{MOVE_UNIT (id=goblin_5) 110 97}
		{MOVE_UNIT (id=goblin_6) 111 97}
		{MOVE_UNIT (id=goblin_7) 112 97}
		{MOVE_UNIT (id=goblin_8) 111 96}
		[lua] 
			code=<< 
				wesnoth.interface.add_overlay_text(_"Gar loses all reason, fury takes over", {location={0,0}, duration=4000, valign="center", halign="center", size=30, color={150,150,150}, fade_time=2000})
				wesnoth.interface.float_label(107, 97, "<span color='red'>".._"Berserker gained".."</span>")
			>> 
		[/lua]
		{GAR_RAGE}
		
		##########	Handle objectives	##########
		[set_variable]
			name=ToA.Scenario_Specific.Sub_Objective_Counter
			value=5
		[/set_variable]
		[set_variable]
			name=ToA.Scenario_Specific.Orcish_Leader_Alive_Timer
			value=0
		[/set_variable]
		
		##########	Sub-event for the Achievement	##########
		[event]
			name=new turn
			id=main_5_sub_4_battle_achievement
				[set_variable]
					name=ToA.Scenario_Specific.Orcish_Leader_Alive_Timer
					value=1
				[/set_variable]
				
				##########	Clean up	##########
				[remove_event]
					id=main_5_sub_4_battle
				[/remove_event]
				[remove_event]
					id=main_5_sub_4_battle_achievement
				[/remove_event]						
		[/event]
	[/event]

	[event] ##########	Main objective 5: A bitter taste, end	##########
		id=main_5_Bitter_Taste_end
		
		##########	Trigger conditions	##########
		name=die
		[filter]
            id=goblin_5
        [/filter]
		[filter_condition]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=5
			[/variable]
			[and]
				[variable]
					name=ToA.Scenario_Specific.Sub_Objective_Counter
					numerical_equals=5
				[/variable]
			[/and]
		[/filter_condition]
				
		##########	Scene setting: animate scene	##########
		[message]
			side=4
			message=_"Chief is dead, run!"
		[/message]
		{MOVE_UNIT (id=goblin_1) 123 99}
		{MOVE_UNIT (id=goblin_6) 123 99}
		{MOVE_UNIT (id=goblin_7) 123 99}
		{MOVE_UNIT (id=goblin_8) 123 99}
		[kill] 
			fire_event=yes
			side=4
		[/kill]
		{MOVE_UNIT (id=gar) 111 98}
		[remove_sound_source]
			id=crowd_screaming
		[/remove_sound_source]
		{SPEAK gar (_ "...")}
		{MOVE_UNIT (id=merissa) 111 98}
		{SPEAK narrator (_ "(<i>Examines Arnelda.</i>)")}
		{SPEAK merissa (_ "...There is nothing I can do.")}
		{MOVE_UNIT (id=mudoc) 111 98}
		{SPEAK mudoc (_ "...We will honor her.")}
		[lua] 
			code=<< 
				wesnoth.audio.play("data/add-ons/Town_of_Arnsreach_Resources_1/sounds/drums.wav")
			>> 
		[/lua]
		{SPEAK gar (_ "(<i>With rigid posture, clenched fists and a stare into nothingness.</i>) We will avenge her.")}
		
		##########	Handle objectives	##########
		[if]
			[variable]
				name=ToA.Scenario_Specific.Orcish_Leader_Alive_Timer
				equals=0
			[/variable]
			[then]
			[set_achievement]
				content_for=wesnoth-Town_of_Arnsreach
				id="berserkgar"
			[/set_achievement]
			[/then]
		[/if]
		{CLEAR_VARIABLE ToA.Scenario_Specific}
		[endlevel]
			{NEW_GOLD_CARRYOVER 100}
			result=victory
			bonus=no
		[/endlevel]
		
		##########	Clean up	##########
		[remove_event]
			id=main_5_Bitter_Taste_end, main_5_sub_1_Fire, main_5_sub_2_extinguish, main_5_sub_3_return, main_5_sub_4_battle, valuables_on_enemy_death
		[/remove_event]	
	[/event]
	
	##########	Defeat events	##########
	{DEATH_DEFEAT_SOMEONE gar ("I... will... kill... you.")}
	{DEATH_DEFEAT_SOMEONE mudoc ("I am sorry...")}
	{DEATH_DEFEAT_SOMEONE merissa ("Help... me...")}
	{DEATH_DEFEAT_SOMEONE sodry ("Fuck.")}
	
	[event] ##########	Arnelda death	##########
		name=last breath
		[filter]
			id=arnelda
		[/filter]
		
		[if]
			[variable]
				name=ToA.Scenario_Specific.Main_Objective_Counter
				numerical_equals=5
			[/variable]
			
			[then]
				[kill]
					id=arnelda
					animate=yes
				[/kill]
			[/then]	
			[else]
				{SPEAK arnelda ("Live well..")}
				[kill]
					id=arnelda
					animate=yes
				[/kill]
				[endlevel]
					result=defeat
				[/endlevel]			
			[/else]
		[/if]
	[/event]
	
	[event] ##########	Valuables on enemy death	##########
		id=valuables_on_enemy_death
		
		##########	Trigger conditions	##########
		first_time_only=no
		name=die
		[filter]
            side=3,4,6
        [/filter]
		
		##########	Mechanics	##########
		[lua]
			code=<<		
				local amount=(wml.variables["unit.level"]+1)*10
				wml.variables["ToA.Town.Valuables"]=wml.variables["ToA.Town.Valuables"] + amount
				wesnoth.interface.float_label(wml.variables["unit.x"], wml.variables["unit.y"], "<span color='yellow'>".._"Gathered valuables: "..amount.."</span>")
			>>
		[/lua]
	[/event]
	
	[event] ##########	Secret stash 1	##########
		id=secret_stash_1
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=78,89
				radius=1
			[/filter_location]
		[/filter]
		
		##########	Mechanics	##########
		[message]
			speaker=unit
			message=_"Some useful things in this debris."
		[/message]
		[lua]
			code=<<		
				local amount=60
				wml.variables["ToA.Town.Valuables"]=wml.variables["ToA.Town.Valuables"] + amount
				wesnoth.interface.float_label(wml.variables["unit.x"], wml.variables["unit.y"], "<span color='yellow'>".._"Gathered valuables: "..amount.."</span>")
			>>
		[/lua]
		[remove_item]
			x,y=78,89
			image=data/core/images/items/ring-red.png
		[/remove_item]
		[set_variable]
			name=ToA.Scenario_Specific.Secrets_Counter
			add=1
		[/set_variable]
	[/event]
	
	[event] ##########	Secret stash 2	##########
		id=secret_stash_2
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=80,108
				radius=1
			[/filter_location]
		[/filter]
		
		##########	Mechanics	##########
		[message]
			speaker=unit
			message=_"An old wreck, little of use to be had."
		[/message]
		[lua]
			code=<<		
				local amount=5
				wml.variables["ToA.Town.Valuables"]=wml.variables["ToA.Town.Valuables"] + amount
				wesnoth.interface.float_label(wml.variables["unit.x"], wml.variables["unit.y"], "<span color='yellow'>".._"Gathered valuables: "..amount.."</span>")
			>>
		[/lua]
		[set_variable]
			name=ToA.Scenario_Specific.Secrets_Counter
			add=1
		[/set_variable]
	[/event]
	
	[event] ##########	Secret stash 3	##########
		id=secret_stash_3
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=92,80
				radius=1
			[/filter_location]
		[/filter]
		
		##########	Mechanics	##########
		[message]
			speaker=unit
			message=_"There is something down there."
		[/message]
		[lua]
			code=<<		
				local amount=45
				wml.variables["ToA.Town.Valuables"]=wml.variables["ToA.Town.Valuables"] + amount
				wesnoth.interface.float_label(wml.variables["unit.x"], wml.variables["unit.y"], "<span color='yellow'>".._"Gathered valuables: "..amount.."</span>")
			>>
		[/lua]
		[remove_item]
			x,y=92,80
			image=data/core/images/items/leather-pack.png
		[/remove_item]
		[set_variable]
			name=ToA.Scenario_Specific.Secrets_Counter
			add=1
		[/set_variable]
	[/event]
	
	[event] ##########	Secret stash 4	##########
		id=secret_stash_4
		
		##########	Trigger conditions	##########
		name=enter_hex
		[filter]
			side=1
			[filter_location]
				x,y=121,97
				radius=1
			[/filter_location]
		[/filter]
		
		##########	Mechanics	##########
		[message]
			speaker=unit
			message=_"No more than a decade since this was put up, by orcs."
		[/message]
		[lua]
			code=<<		
				local amount=20
				wml.variables["ToA.Town.Valuables"]=wml.variables["ToA.Town.Valuables"] + amount
				wesnoth.interface.float_label(wml.variables["unit.x"], wml.variables["unit.y"], "<span color='yellow'>".._"Gathered valuables: "..amount.."</span>")
			>>
		[/lua]
		[remove_item]
			x,y=121,97
			image=data/core/images/items/buckler.png
		[/remove_item]
		[set_variable]
			name=ToA.Scenario_Specific.Secrets_Counter
			add=1
		[/set_variable]
	[/event]
	
	[event] ##########	On load game	##########
		first_time_only=no
		name=preload
		[lua]
			code=<<
				wesnoth.dofile '~add-ons/Town_of_Arnsreach/utils/ui.lua'
			>>
		[/lua]
	[/event]

	##########	Adjustments	##########
	{Scenario_Setup}
	{TOA_TAUNTED_AI (1,2,3,4,5,6,7)}
	{TOA_SNOW_WALK_PLAYER (1,5)}
    {TOA_DISABLE_XP}
    {TOA_WALKING_CORPSE_SETUP}
	{TOA_WALKING_CORPSE_TELEPORT}
	{TOA_ZOMBIE_SOUNDS}
	{TOA_DISABLE_VILLAGE_CAPTURE}
	
	##########	Custom Terrain	##########
	[terrain_graphics]
		x,y=75,94
		[image]
			layer=0
			center=90,90
			name=landmarks/Stone_pillar_circle_snow.png
		[/image]
		map="
			*,*,*,*
			,*,*,*
			*,*,*,*
			,*,*,*"
	[/terrain_graphics]
	[terrain_graphics]
		x,y=121, 105
		[image]
			layer=0
			center=120,180
			name=landmarks/Jagged_coast.png~SCALE(250,250)
		[/image]
		map="
			*,*,*,*,*,*,*
			,*,*,*,*,*,*
			*,*,*,*,*,*,*
			,*,*,*,*,*,*
			*,*,*,*,*,*,*
			,*,*,*,*,*,*"
	[/terrain_graphics]
	[terrain_graphics]
		x,y=96, 95
		[image]
			layer=0
			center=90,145
			name=landmarks/water_hole.png
		[/image]
		map="
			*,*,*,*,*,*,*
			,*,*,*,*,*,*
			*,*,*,*,*,*,*
			,*,*,*,*,*,*
			*,*,*,*,*,*,*
			,*,*,*,*,*,*"
	[/terrain_graphics]
	[terrain_graphics]
		x,y=92, 111
		[image]
			layer=0
			center=85,85
			name=landmarks/aincent_stone_gate_snow.png
		[/image]
		map="
			*,*,*,*
			,*,*,*
			*,*,*,*
			,*,*,*"
	[/terrain_graphics]
[/scenario]
